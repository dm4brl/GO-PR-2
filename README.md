# Центральная система управления пользовательскими устройствами (свитчами)

## Описание проекта
Данный проект представляет собой серверную систему для автоматического управления умными выключателями (свитчами) на основе расписания пользователей и еврейского календаря.

## Основной воркфлоу
1. В базе данных зарегистрированы:
   - Пользователи (с привязанной геолокацией).
   - Их устройства (умные свитчи).
   - Расписание работы устройств.
2. При смене даты сервер проверяет, наступает ли в этот день Шаббат или Йом Тов.
3. Если да, запускается скрипт формирования очереди задач (включение/выключение устройств):
   - Начало автоматизации (включение) рассчитывается согласно геопозиции пользователя.
   - Все последующие действия выполняются по расписанию пользователя.
   - Окончание автоматизации также определяется на основе геопозиции.

## Определение Шаббата и Йом Тов
Для определения начала и конца Шаббата/Йом Тов используются алгоритмы расчета восхода и захода солнца в зависимости от геолокации пользователя и еврейского календаря.

## Архитектура
- **Backend:** Golang + Gin
- **База данных:** PostgreSQL
- **Кэширование:** Redis
- **Мессенджинг:** MQTT (для управления устройствами)
- **API:** REST API для взаимодействия с клиентскими приложениями

## Основные компоненты
- **API:** Обработчик HTTP-запросов (регистрация пользователей, управление устройствами, расписание)
- **Сервис управления расписанием:** Формирование очереди задач
- **Интеграция с MQTT:** Команды для умных выключателей
- **База данных:** Хранение пользователей, устройств, расписаний
- **Конфигурационный модуль:** Настройки системы

## Планы по разработке
1. Реализация API и базовых моделей данных.
2. Разработка механизма расчета Шаббата/Йом Тов.
3. Интеграция с MQTT для управления свитчами.
4. Подключение к Redis для кеширования данных.
5. Оптимизация логики автоматизации.
















# GO-PR-2 Backend System

## Описание проекта

GO-PR-2 — это система центрального управления пользовательскими устройствами (свитчами), предназначенная для автоматизации процессов, связанных с соблюдением еврейских законов Шаббата и Йом Тов, а также для управления устройствами через интерфейс API. Система включает в себя поддержку геолокации пользователей, учет расписания работы устройств и автоматическое включение/выключение устройств на основе времени.

## Архитектура системы

Проект состоит из следующих основных компонентов:
1. **Backend (Gin + Go)**: Сервер для обработки запросов, интеграции с БД, Redis и MQTT.
2. **PostgreSQL**: База данных для хранения информации о пользователях, устройствах и расписаниях.
3. **Redis**: Используется для обработки очередей задач и автоматизации.
4. **MQTT**: Протокол для управления устройствами.

## Структура проекта

GO-PR-2/
│── cmd/                  # Главный исполняемый файл
│── internal/             # Внутренние модули
│   ├── config/           # Конфигурация приложения
│   ├── db/               # Подключение к БД
│   ├── models/           # Определение моделей (пользователи, устройства, расписание)
│   ├── services/         # Логика работы с устройствами
│   ├── api/              # HTTP API
│── pkg/                  # Общие библиотеки
│── scripts/              # Скрипты развертывания
│── go.mod                # Модуль Go
│── go.sum                # Контроль зависимостей
│── README.md             # Описание проекта


## Логика работы бэкенда

1. **Регистрация пользователей**: В базе данных хранится информация о пользователях и их геолокации.
2. **Устройства и их расписания**: Устройства могут быть зарегистрированы с привязанным расписанием работы. Каждое устройство связано с конкретным пользователем.
3. **Определение события Шаббат или Йом Тов**: 
   - События (Шаббат или Йом Тов) определяются на основе еврейского календаря и текущей даты.
   - Для определения этих событий система использует геолокацию пользователя и соответствующие временные параметры (например, время захода и восхода солнца).
   - Если текущая дата совпадает с днем Шаббата или Йом Тов, система запускает скрипт для формирования очереди задач для включения/выключения устройств.
4. **Автоматизация на основе геопозиции**: Время начала автоматизации рассчитывается на основе геопозиции пользователя, а все последующие действия выполняются по расписанию, установленному пользователем.
5. **Окончание автоматизации**: Окончание автоматизации также определяется на основе геопозиции пользователя.

## Зависимости

- **Gin** — фреймворк для создания API.
- **Gorm** — ORM для работы с PostgreSQL.
- **Redis** — для обработки очередей задач.
- **Paho MQTT** — для работы с MQTT устройствами.

## Установка

1. Клонируйте репозиторий:
    ```bash
    git clone https://github.com/dm4brl/GO-PR-2.git
    cd GO-PR-2
    ```

2. Инициализируйте зависимости:
    ```bash
    go mod tidy
    ```

3. Настройте переменные окружения для подключения к базе данных и Redis (например, в файле `.env`).

4. Запустите сервер:
    ```bash
    go run cmd/app-server/main.go
    ```

5. Приложение будет доступно по адресу: [http://localhost:8080](http://localhost:8080)

